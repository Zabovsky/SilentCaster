<div class="main-container">
  <header class="main-header">
    <h1>SilentCaster 2.0</h1>
    <div class="header-right">
      <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º -->
      <div class="theme-switcher">
        <button 
          type="button"
          class="theme-btn" 
          [class.active]="currentTheme === 'light'"
          (click)="onThemeChange('light')"
          title="–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞"
          aria-label="–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞"
        >
          <span class="theme-icon">‚òÄÔ∏è</span>
        </button>
        <button 
          type="button"
          class="theme-btn" 
          [class.active]="currentTheme === 'dark'"
          (click)="onThemeChange('dark')"
          title="–¢–µ–º–Ω–∞—è —Ç–µ–º–∞"
          aria-label="–¢–µ–º–Ω–∞—è —Ç–µ–º–∞"
        >
          <span class="theme-icon">üåô</span>
        </button>
        <button 
          type="button"
          class="theme-btn" 
          [class.active]="currentTheme === 'peach'"
          (click)="onThemeChange('peach')"
          title="–ü–µ—Ä—Å–∏–∫–æ–≤–∞—è —Ç–µ–º–∞"
          aria-label="–ü–µ—Ä—Å–∏–∫–æ–≤–∞—è —Ç–µ–º–∞"
        >
          <span class="theme-icon">üçë</span>
        </button>
      </div>
      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
      <div class="user-info" *ngIf="isAuthenticated && authenticatedUserInfo">
        <img [src]="authenticatedUserInfo.profile_image_url || 'https://static-cdn.jtvnw.net/user-default-pictures-uv/294c98b5-e34d-42cd-a8f0-14046872a620-profile_image-70x70.png'" 
             [alt]="authenticatedUserInfo.display_name" 
             class="user-avatar-small" />
        <span class="user-name-small">{{ authenticatedUserInfo.display_name }}</span>
      </div>
      <!-- –ö–Ω–æ–ø–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω) -->
      <button 
        *ngIf="!isAuthenticated"
        class="btn-auth-header" 
        (click)="showTwitchAuth = true"
        title="–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Twitch"
      >
        üîê
      </button>
      <div class="connection-status" [class.connected]="isConnected" [class.disconnected]="!isConnected">
        {{ connectionStatus }}
      </div>
    </div>
  </header>

  <div class="main-content">
    <section class="connection-section">
      <div class="input-group">
        <label for="channel">–ö–∞–Ω–∞–ª Twitch:</label>
        <input 
          type="text" 
          id="channel" 
          [(ngModel)]="channel" 
          placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞"
          [disabled]="isConnected"
        />
        <button 
          (click)="connect()" 
          [disabled]="isConnected || !channel.trim()"
          class="btn btn-primary"
        >
          üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
        </button>
        <button 
          (click)="disconnect()" 
          [disabled]="!isConnected"
          class="btn btn-secondary"
        >
          ‚ùå –û—Ç–∫–ª—é—á–∏—Ç—å—Å—è
        </button>
        <button 
          (click)="testVoice()" 
          class="btn btn-test"
        >
          üéµ –¢–µ—Å—Ç –≥–æ–ª–æ—Å–∞
        </button>
        <button 
          (click)="showSettings = !showSettings" 
          class="btn btn-settings"
          [class.active]="showSettings"
        >
          ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        </button>
      </div>
    </section>
    
    <!-- –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <section class="settings-section" *ngIf="showSettings">
      <app-settings></app-settings>
    </section>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div class="auth-modal-overlay" *ngIf="showTwitchAuth" (click)="showTwitchAuth = false">
      <div class="auth-modal-content" (click)="$event.stopPropagation()">
        <div class="auth-modal-header">
          <h2>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Twitch</h2>
          <button class="auth-modal-close" (click)="showTwitchAuth = false" title="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
        </div>
        <div class="auth-modal-body">
          <app-twitch-auth 
            (authSuccess)="onAuthSuccessFromTwitchAuth($event)"
            (authCancel)="showTwitchAuth = false"
          ></app-twitch-auth>
        </div>
      </div>
    </div>

    <section class="chat-section">
      <div class="chat-header">
        <h2>–ß–∞—Ç</h2>
        <div class="chat-actions">
          <select 
            class="chat-sort-select"
            [(ngModel)]="chatSortOrder"
            (change)="onSortOrderChange()"
            title="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —á–∞—Ç–∞"
          >
            <option value="time-asc">‚è±Ô∏è –ü–æ –≤—Ä–µ–º–µ–Ω–∏ (—Å—Ç–∞—Ä—ã–µ ‚Üí –Ω–æ–≤—ã–µ)</option>
            <option value="time-desc">‚è±Ô∏è –ü–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–æ–≤—ã–µ ‚Üí —Å—Ç–∞—Ä—ã–µ)</option>
            <option value="user-asc">üë§ –ü–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–ê ‚Üí –Ø)</option>
            <option value="user-desc">üë§ –ü–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–Ø ‚Üí –ê)</option>
          </select>
          <button 
            class="btn-icon" 
            (click)="clearChat()" 
            title="–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç"
            *ngIf="isModerator"
          >
            üóëÔ∏è
          </button>
          <button 
            class="btn-icon" 
            (click)="toggleAutoScroll()" 
            [class.active]="autoScroll"
            title="–ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞"
          >
            üìú
          </button>
        </div>
      </div>
      <div class="chat-messages" #chatContainer (scroll)="onChatScroll()">
        <app-chat-message 
          *ngFor="let message of sortedChatMessages; trackBy: trackByTimestamp"
          [message]="message"
          [isModerator]="isModerator"
          [channel]="channel"
          [activeModerationMenu]="activeModerationMenu"
          (messageDeleted)="onMessageDeleted($event)"
          (moderationMenuToggled)="onModerationMenuToggled($event)"
          (showUserProfile)="showUserProfile($event)"
          (toggleUserHighlight)="toggleUserHighlight($event)"
        ></app-chat-message>
        <div *ngIf="sortedChatMessages.length === 0" class="no-messages">
          <div class="no-messages-icon">üí¨</div>
          <p>–°–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</p>
        </div>
      </div>
    </section>
    
    <!-- –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ–∑–≤—É—á–∫–∏ -->
    <section class="voice-settings-section" *ngIf="showVoiceSettings">
      <div class="settings-panel">
        <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∑–≤—É—á–∫–∏</h3>
        <div class="settings-group">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="settings.enableChatVoice" (change)="saveVoiceSettings()" />
            <span>–í–∫–ª—é—á–∏—Ç—å –æ–∑–≤—É—á–∫—É —á–∞—Ç–∞</span>
          </label>
          
          <div class="form-group">
            <label>–¢—Ä–∏–≥–≥–µ—Ä-—Å–∏–º–≤–æ–ª (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –æ–∑–≤—É—á–∫–∏ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π):</label>
            <input 
              type="text" 
              [(ngModel)]="settings.chatTriggerSymbol" 
              (change)="saveVoiceSettings()"
              placeholder="!!!" 
              maxlength="10"
            />
            <small class="form-hint">–ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω, –æ–∑–≤—É—á–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ —ç—Ç–æ—Ç —Å–∏–º–≤–æ–ª</small>
          </div>
          
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="settings.voiceOnlyForSubscribers" (change)="saveVoiceSettings()" />
            <span>–¢–æ–ª—å–∫–æ –¥–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="settings.voiceOnlyForVips" (change)="saveVoiceSettings()" />
            <span>–¢–æ–ª—å–∫–æ –¥–ª—è VIP</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="settings.voiceOnlyForModerators" (change)="saveVoiceSettings()" />
            <span>–¢–æ–ª—å–∫–æ –¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="settings.voiceOnlyForFollowers" (change)="saveVoiceSettings()" />
            <span>–¢–æ–ª—å–∫–æ –¥–ª—è —Ñ–æ–ª–ª–æ–≤–µ—Ä–æ–≤</span>
          </label>
        </div>
      </div>
    </section>
  </div>
  
  <!-- –î–∏–∞–ª–æ–≥ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
  <app-user-profile 
    *ngIf="showUserProfileDialog"
    [username]="selectedUser"
    [messages]="chatMessages"
    [channel]="channel"
    (close)="closeUserProfile()"
  ></app-user-profile>
</div>

