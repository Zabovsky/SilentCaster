<div class="settings-container">
  <div class="settings-header">
    <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
  </div>

  <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
  <div class="user-info-section" *ngIf="isAuthenticated && userInfo">
    <div class="user-card">
      <img [src]="userInfo.profile_image_url || 'https://static-cdn.jtvnw.net/user-default-pictures-uv/294c98b5-e34d-42cd-a8f0-14046872a620-profile_image-70x70.png'" 
           [alt]="userInfo.display_name" 
           class="user-avatar" />
      <div class="user-details">
        <div class="user-name">{{ userInfo.display_name }}</div>
        <div class="user-login">{{ '@' + userInfo.login }}</div>
      </div>
      <button class="btn btn-secondary btn-small" (click)="logout()">–í—ã–π—Ç–∏</button>
    </div>
  </div>

  <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω) -->
  <div class="auth-section" *ngIf="!isAuthenticated">
    <div class="section-header">
      <h3>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Twitch</h3>
      <button class="btn-toggle" (click)="showAuthSection = !showAuthSection">
        {{ showAuthSection ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å' }}
      </button>
    </div>
    <app-twitch-auth 
      *ngIf="showAuthSection"
      (authSuccess)="onAuthSuccess()"
    ></app-twitch-auth>
  </div>

  <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–∞ -->
  <div class="settings-section">
    <h3>üí¨ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–∞</h3>
    <div class="settings-group">
      <label class="setting-item">
        <span class="setting-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π:</span>
        <input 
          type="number" 
          [(ngModel)]="settings.maxChatMessages" 
          min="50" 
          max="1000" 
          step="50"
          class="setting-input"
        />
        <span class="setting-hint">–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: {{ settings.maxChatMessages || 100 }}</span>
      </label>
    </div>
  </div>

  <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∑–≤—É—á–∫–∏ -->
  <div class="settings-section">
    <h3>üîä –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∑–≤—É—á–∫–∏</h3>
    <div class="settings-group">
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="settings.enableChatVoice" />
        <span>–í–∫–ª—é—á–∏—Ç—å –æ–∑–≤—É—á–∫—É —á–∞—Ç–∞</span>
      </label>
      <label class="setting-item" *ngIf="settings.enableChatVoice">
        <span class="setting-label">–°–∏–º–≤–æ–ª —Ç—Ä–∏–≥–≥–µ—Ä–∞:</span>
        <input 
          type="text" 
          [(ngModel)]="settings.chatTriggerSymbol" 
          placeholder="!!!"
          class="setting-input"
        />
        <span class="setting-hint">–û–∑–≤—É—á–∏–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —ç—Ç–∏–º —Å–∏–º–≤–æ–ª–æ–º</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="settings.voiceOnlyForSubscribers" />
        <span>–¢–æ–ª—å–∫–æ –¥–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="settings.voiceOnlyForVips" />
        <span>–¢–æ–ª—å–∫–æ –¥–ª—è VIP</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="settings.voiceOnlyForModerators" />
        <span>–¢–æ–ª—å–∫–æ –¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="settings.voiceOnlyForFollowers" />
        <span>–¢–æ–ª—å–∫–æ –¥–ª—è —Ñ–æ–ª–ª–æ–≤–µ—Ä–æ–≤</span>
      </label>
    </div>
  </div>

  <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ -->
  <div class="settings-section">
    <h3>üö´ –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞</h3>
    <div class="settings-group">
      <p class="info-text" style="color: #b0b0b0; font-size: 0.9rem; margin-bottom: 1rem;">
        –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ. –°–æ–æ–±—â–µ–Ω–∏—è —Å –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ –±—É–¥—É—Ç –≤—ã–¥–µ–ª–µ–Ω—ã.
      </p>
      
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="settings.moderationSettings.forbiddenWordsEnabled" />
        <span>–í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="settings.moderationSettings.caseSensitive" />
        <span>–£—á–∏—Ç—ã–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä</span>
      </label>
      
      <div class="forbidden-words-management" style="margin-top: 1rem;">
        <label class="setting-item">
          <span class="setting-label">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–µ —Å–ª–æ–≤–æ:</span>
          <div style="display: flex; gap: 0.5rem; align-items: center; flex: 1;">
            <input 
              type="text" 
              [(ngModel)]="newForbiddenWord" 
              placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ"
              (keyup.enter)="addForbiddenWord()"
              class="setting-input"
              style="flex: 1;"
            />
            <button class="btn-add-word" (click)="addForbiddenWord()" [disabled]="!newForbiddenWord.trim()" title="–î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ">
              ‚ûï
            </button>
          </div>
        </label>
        
        <div class="forbidden-words-list" *ngIf="forbiddenWords.length > 0">
          <div class="list-header">
            <span>–ù–∞–π–¥–µ–Ω–æ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤: {{ forbiddenWords.length }}</span>
          </div>
          <div class="words-container">
            <div class="word-item" *ngFor="let word of forbiddenWords">
              <span class="word-text">{{ word }}</span>
              <button class="btn-remove" (click)="removeForbiddenWord(word)" title="–£–¥–∞–ª–∏—Ç—å">‚ùå</button>
            </div>
          </div>
        </div>
        
        <div class="banned-words-info" *ngIf="forbiddenWords.length === 0">
          <p style="color: #888; font-style: italic; margin: 1rem 0; padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 6px; text-align: center;">
            üìã –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤ –ø—É—Å—Ç
            <br><small>–î–æ–±–∞–≤—å—Ç–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ.</small>
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
  <div class="settings-section">
    <h3>üõ°Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</h3>
    <div class="settings-group">
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="settings.moderationSettings.spamDetectionEnabled" />
        <span>–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–ø–∞–º–∞</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="settings.moderationSettings.capsDetectionEnabled" />
        <span>–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–∞–ø—Å–∞</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="settings.moderationSettings.messageLengthCheckEnabled" />
        <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è</span>
      </label>
      <label class="setting-item" *ngIf="settings.moderationSettings.messageLengthCheckEnabled">
        <span class="setting-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:</span>
        <input 
          type="number" 
          [(ngModel)]="settings.moderationSettings.maxMessageLength" 
          min="50" 
          max="500"
          class="setting-input"
        />
      </label>
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="settings.moderationSettings.autoDeleteHighSeverity" />
        <span>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤—ã—Å–æ–∫–∏–º —É—Ä–æ–≤–Ω–µ–º –Ω–∞—Ä—É—à–µ–Ω–∏—è</span>
      </label>
    </div>
  </div>

  <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–Ω–≤–æ—Ä–¥–∞–º–∏ Twitch -->
  <div class="settings-section">
    <h3>üö´ –ë–∞–Ω–≤–æ—Ä–¥—ã Twitch</h3>
    <div class="settings-group">
      <p class="info-text" style="color: #b0b0b0; font-size: 0.9rem; margin-bottom: 1rem;">
        –ë–∞–Ω–≤–æ—Ä–¥—ã Twitch –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π. –î–ª—è —Ä–∞–±–æ—Ç—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–∞–≤–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞.
        <br><small style="color: #888;">–¢–µ–∫—É—â–∏–π –∫–∞–Ω–∞–ª: <strong>{{ currentChannel || '–Ω–µ —É–∫–∞–∑–∞–Ω' }}</strong></small>
      </p>
      
      <div class="banned-words-info" *ngIf="!isAuthenticated" style="margin-bottom: 1rem; padding: 1rem; background: rgba(255, 193, 7, 0.1); border-radius: 6px; border: 1px solid rgba(255, 193, 7, 0.3);">
        <p style="color: #ffc107; margin: 0; font-size: 0.9rem;">
          ‚ö†Ô∏è –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–Ω–≤–æ—Ä–¥–∞–º–∏ Twitch —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ Twitch –≤—ã—à–µ.
        </p>
      </div>
      
      <div class="banned-words-actions" *ngIf="isAuthenticated">
        <button 
          class="btn btn-secondary" 
          (click)="loadTwitchBannedWords()"
          [disabled]="isLoadingBannedWords || !currentChannel"
          style="margin-bottom: 1rem;"
        >
          {{ isLoadingBannedWords ? '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...' : 'üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ Twitch' }}
        </button>
      </div>

      <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –±–∞–Ω–≤–æ—Ä–¥–æ–≤ –≤—Å–µ–≥–¥–∞ -->
      <div class="banned-words-list">
        <div class="list-header" *ngIf="twitchBannedWords.length > 0">
          <span>–ù–∞–π–¥–µ–Ω–æ –±–∞–Ω–≤–æ—Ä–¥–æ–≤: {{ twitchBannedWords.length }}</span>
        </div>
        
        <div class="words-container" *ngIf="twitchBannedWords.length > 0">
          <div class="word-item" *ngFor="let word of twitchBannedWords">
            <span class="word-text">{{ word }}</span>
            <button class="btn-remove" (click)="removeTwitchBannedWord(word)" title="–£–¥–∞–ª–∏—Ç—å –∏–∑ Twitch">‚ùå</button>
          </div>
        </div>

        <div class="banned-words-info" *ngIf="twitchBannedWords.length === 0 && !isLoadingBannedWords">
          <p style="color: #888; font-style: italic; margin: 1rem 0; padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 6px; text-align: center;">
            üìã –°–ø–∏—Å–æ–∫ –±–∞–Ω–≤–æ—Ä–¥–æ–≤ –ø—É—Å—Ç
            <br><small>–ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ Twitch" –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –≤–∞—à–∏–º –∫–∞–Ω–∞–ª–æ–º.</small>
          </p>
        </div>

        <div class="banned-words-info" *ngIf="isLoadingBannedWords">
          <p style="color: var(--accent-primary); margin: 1rem 0; padding: 1rem; background: var(--bg-tertiary); border-radius: 6px; text-align: center;">
            ‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–Ω–≤–æ—Ä–¥–æ–≤ –∏–∑ Twitch...
          </p>
        </div>
      </div>

      <div class="add-word-section" style="margin-top: 1rem;" *ngIf="isAuthenticated">
        <div class="input-group">
          <input 
            type="text" 
            [(ngModel)]="newTwitchBannedWord" 
            placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ Twitch" 
            (keyup.enter)="addTwitchBannedWord()"
            class="setting-input"
            style="flex: 1; margin-right: 0.5rem;"
          />
          <button class="btn-add-word" (click)="addTwitchBannedWord()" [disabled]="!newTwitchBannedWord.trim() || !currentChannel" title="–î–æ–±–∞–≤–∏—Ç—å –≤ Twitch">
            ‚ûï
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
  <div class="settings-actions">
    <button class="btn btn-primary" (click)="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
  </div>
</div>

