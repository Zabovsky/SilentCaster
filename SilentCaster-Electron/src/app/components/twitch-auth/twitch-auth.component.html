<div class="twitch-auth-container">
  <div class="auth-header">
    <div class="auth-icon">üîê</div>
    <h3>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Twitch</h3>
    <p class="auth-description">
      –î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Twitch.
      <br>
      <small>–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä, –≥–¥–µ –≤—ã —Å–º–æ–∂–µ—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è.</small>
    </p>
    <div class="oauth-info">
      <p class="info-text">
        <strong>‚ö†Ô∏è –í–ê–ñ–ù–û:</strong> –ü–µ—Ä–µ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–∞—à–µ–≥–æ Twitch –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω Redirect URI:
        <br>
        <code>http://localhost:3001/auth/callback</code>
        <br>
        <small style="color: #ff6b6b; font-weight: bold;">
          ‚ö†Ô∏è –ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É redirect_mismatch, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Twitch:
          <br>
          1. Redirect URI –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¢–û–ß–ù–û: <code>http://localhost:3001/auth/callback</code>
          <br>
          2. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ <code>http://localhost:3001/</code> –∏–ª–∏ <code>http://localhost:3001</code>
          <br>
          3. –ü—É—Ç—å –¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ <code>/auth/callback</code>
        </small>
        <br>
        <small>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: <a href="https://dev.twitch.tv/console/apps" target="_blank">dev.twitch.tv/console/apps</a> ‚Üí –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí OAuth Redirect URLs</small>
      </p>
    </div>
  </div>

  <!-- –°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
  <div class="auth-status" *ngIf="isAuthenticated && userInfo">
    <div class="user-info">
      <img [src]="userInfo.profile_image_url || 'https://static-cdn.jtvnw.net/user-default-pictures-uv/294c98b5-e34d-42cd-a8f0-14046872a620-profile_image-70x70.png'" 
           [alt]="userInfo.display_name" 
           class="user-avatar" />
      <div class="user-details">
        <div class="user-name">{{ userInfo.display_name }}</div>
        <div class="user-login">{{ '@' + userInfo.login }}</div>
      </div>
    </div>
    <button class="btn btn-secondary" (click)="logout()">–í—ã–π—Ç–∏</button>
  </div>

  <!-- –§–æ—Ä–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
  <div class="auth-form" *ngIf="!isAuthenticated">
    <div class="auth-benefits">
      <h4>–ß—Ç–æ –¥–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:</h4>
      <ul class="benefits-list">
        <li>‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ü–∏–µ–π —á–∞—Ç–∞</li>
        <li>‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π</li>
        <li>‚úÖ –¢–∞–π–º–∞—É—Ç—ã –∏ –±–∞–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
        <li>‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–Ω–≤–æ—Ä–¥–∞–º–∏ Twitch</li>
        <li>‚úÖ –î–æ—Å—Ç—É–ø –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º</li>
      </ul>
    </div>

    <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º -->
    <div class="advanced-mode">
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="useAdvancedMode" />
        <span>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–π Client ID –∏ Secret</span>
      </label>
      <small class="hint-text">–û–±—ã—á–Ω–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Twitch.</small>
    </div>

    <div class="advanced-fields" *ngIf="useAdvancedMode">
      <div class="form-group">
        <label>Client ID:</label>
        <input type="text" [(ngModel)]="clientId" placeholder="–í–∞—à Twitch Client ID" />
      </div>
      <div class="form-group">
        <label>Client Secret:</label>
        <input type="password" [(ngModel)]="clientSecret" placeholder="–í–∞—à Twitch Client Secret" />
      </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div class="auth-button-container">
      <button 
        class="btn btn-primary btn-large" 
        (click)="startAuth()" 
        [disabled]="isAuthenticating"
      >
        <span class="btn-icon">üîê</span>
        <span class="btn-text">
          {{ isAuthenticating ? '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...' : '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Twitch' }}
        </span>
      </button>
      <p class="auth-hint" *ngIf="!isAuthenticating">
        –ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä —Å —Å–∞–π—Ç–æ–º Twitch –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
      </p>
    </div>

    <!-- –ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div class="auth-process" *ngIf="isAuthenticating">
      <div class="auth-status-info">
        <div class="status-icon">‚è≥</div>
        <h4>–û–∂–∏–¥–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h4>
        <p class="info-text">
          –ë—Ä–∞—É–∑–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã–ª –æ—Ç–∫—Ä—ã—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ï—Å–ª–∏ –Ω–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞.
        </p>
        <p class="info-text">
          –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
        </p>
        <div class="loading-spinner"></div>
      </div>

      <!-- Device Flow (fallback) -->
      <div class="device-flow-info" *ngIf="deviceFlowInfo">
        <p class="info-text">
          <strong>–®–∞–≥ 1:</strong> –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
        </p>
        <a [href]="deviceFlowInfo.verification_uri" target="_blank" class="verification-link">
          {{ deviceFlowInfo.verification_uri }}
        </a>
        
        <p class="info-text">
          <strong>–®–∞–≥ 2:</strong> –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥:
        </p>
        <div class="user-code-container">
          <div class="user-code">{{ deviceFlowInfo.user_code }}</div>
          <button class="btn-icon" (click)="copyUserCode()" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å">
            üìã
          </button>
        </div>
      </div>

      <button class="btn btn-secondary" (click)="cancelAuth()">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

