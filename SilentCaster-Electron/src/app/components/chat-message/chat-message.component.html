<div 
  class="chat-message compact" 
  [class.subscriber]="message.isSubscriber"
  [class.vip]="message.isVip"
  [class.moderator]="message.isModerator"
  [class.follower]="message.isFollower"
  [class.highlighted]="message.isHighlighted"
  [class.violation]="message.violation?.hasViolation"
  [class.violation-high]="message.violation?.severity === 'high'"
  [class.violation-medium]="message.violation?.severity === 'medium'"
  [class.violation-low]="message.violation?.severity === 'low'"
  (contextmenu)="toggleModerationMenu($event)"
  (dblclick)="onDoubleClick()"
>
  <div class="message-content">
    <div class="message-header">
      <span class="user-info">
        <span class="user-badges">
          <span class="badge follower" *ngIf="message.isFollower" title="–§–æ–ª–ª–æ–≤–µ—Ä">üë•</span>
          <span class="badge highlighted" *ngIf="message.isHighlighted" title="–û—Ç–º–µ—á–µ–Ω">‚≠ê</span>
        </span>
        <span class="username" [style.color]="message.userColor">{{ message.username }}</span>
      </span>
      <span class="message-text">{{ message.message }}</span>
      <span class="violation-badge" *ngIf="hasViolation">
        ‚ö†Ô∏è {{ violationReason }}
      </span>
      <span class="timestamp">{{ message.timestamp | date:'HH:mm:ss' }}</span>
    </div>
    
    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º—ã –¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤) -->
    <div class="quick-actions" *ngIf="isModerator && message.violation?.hasViolation">
      <button class="quick-btn delete" (click)="quickDelete()" title="–£–¥–∞–ª–∏—Ç—å">
        üóëÔ∏è
      </button>
      <button class="quick-btn timeout" (click)="quickTimeout1min()" title="–ú—É—Ç 1 –º–∏–Ω">
        ‚è±Ô∏è 1–º
      </button>
      <button class="quick-btn timeout" (click)="quickTimeout5min()" title="–ú—É—Ç 5 –º–∏–Ω">
        ‚è±Ô∏è 5–º
      </button>
      <button class="quick-btn timeout" (click)="quickTimeout10min()" title="–ú—É—Ç 10 –º–∏–Ω">
        ‚è±Ô∏è 10–º
      </button>
      <button class="quick-btn ban" (click)="quickBanUser()" title="–ó–∞–±–∞–Ω–∏—Ç—å">
        üö´
      </button>
    </div>
    
    <!-- –ü–æ–ª–Ω–æ–µ –º–µ–Ω—é –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
    <div class="message-actions" *ngIf="isModerator && showModerationMenu && activeModerationMenu === message.timestamp.toString()">
      <button class="action-btn delete" (click)="deleteMessage()" title="–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ">
        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
      </button>
      <button class="action-btn timeout" (click)="openTimeoutDialog()" title="–¢–∞–π–º–∞—É—Ç">
        ‚è±Ô∏è –¢–∞–π–º–∞—É—Ç
      </button>
      <button class="action-btn ban" (click)="banUser()" title="–ó–∞–±–∞–Ω–∏—Ç—å">
        üö´ –ó–∞–±–∞–Ω–∏—Ç—å
      </button>
      <button class="action-btn highlight" (click)="toggleHighlight()" [class.active]="message.isHighlighted" title="–û—Ç–º–µ—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
        {{ message.isHighlighted ? '‚≠ê –û—Ç–º–µ—á–µ–Ω' : '‚≠ê –û—Ç–º–µ—Ç–∏—Ç—å' }}
      </button>
    </div>
  </div>

  <!-- Timeout Dialog -->
  <div class="timeout-dialog-overlay" *ngIf="showTimeoutDialog" (click)="closeTimeoutDialog()">
    <div class="timeout-dialog" (click)="$event.stopPropagation()">
      <h3>–¢–∞–π–º–∞—É—Ç –¥–ª—è {{ message.username }}</h3>
      
      <div class="form-group">
        <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫—É–Ω–¥—ã):</label>
        <input 
          type="number" 
          [(ngModel)]="timeoutDuration" 
          min="1" 
          max="1209600"
          placeholder="600"
        />
        <div class="duration-presets">
          <button (click)="timeoutDuration = 60">1 –º–∏–Ω</button>
          <button (click)="timeoutDuration = 300">5 –º–∏–Ω</button>
          <button (click)="timeoutDuration = 600">10 –º–∏–Ω</button>
          <button (click)="timeoutDuration = 3600">1 —á–∞—Å</button>
        </div>
      </div>

      <div class="form-group">
        <label>–ü—Ä–∏—á–∏–Ω–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
        <input 
          type="text" 
          [(ngModel)]="timeoutReason" 
          placeholder="–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —á–∞—Ç–∞"
        />
      </div>

      <div class="dialog-actions">
        <button class="btn btn-primary" (click)="timeoutUser()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        <button class="btn btn-secondary" (click)="closeTimeoutDialog()">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>
</div>

